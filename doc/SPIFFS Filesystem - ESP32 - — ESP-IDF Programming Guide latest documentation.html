<!DOCTYPE html>
<!-- saved from url=(0093)https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html -->
<html class="writer-html5" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async="" src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/js"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-132861133-1');
        </script><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SPIFFS Filesystem - ESP32 -  — ESP-IDF Programming Guide latest documentation</title>
      <link rel="stylesheet" href="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/pygments.css" type="text/css">
      <link rel="stylesheet" href="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/theme.css" type="text/css">
      <link rel="stylesheet" href="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/copybutton.css" type="text/css">
      <link rel="stylesheet" href="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/theme_overrides.css" type="text/css">
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/documentation_options.js"></script>
        <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/jquery.js"></script>
        <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/underscore.js"></script>
        <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/doctools.js"></script>
        <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/clipboard.min.js"></script>
        <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/copybutton.js"></script>
        <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/default.js"></script>
        <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/wavedrom.min.js"></script>
    <script src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'api-reference/storage/spiffs';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2"]
        DOCUMENTATION_OPTIONS.RELEASE = 'latest';
    </script>

    <script type="text/javascript" src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/about.html">
    <link rel="index" title="Index" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/genindex.html">
    <link rel="search" title="Search" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/search.html">
    <link rel="next" title="Virtual filesystem component" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/vfs.html">
    <link rel="prev" title="Concurrency Constraints for flash on SPI1" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spi_flash_concurrency.html"> 
<style type="text/css">div.wavedromMenu{position:fixed;border:solid 1pt#CCCCCC;background-color:white;box-shadow:0px 10px 20px #808080;cursor:default;margin:0px;padding:0px;}div.wavedromMenu>ul{margin:0px;padding:0px;}div.wavedromMenu>ul>li{padding:2px 10px;list-style:none;}div.wavedromMenu>ul>li:hover{background-color:#b5d5ff;}</style></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/index.html" class="icon icon-home"> ESP-IDF Programming Guide
            <img src="./SPIFFS Filesystem - ESP32 - — ESP-IDF Programming Guide latest documentation_files/espressif-logo.svg" class="logo" alt="Logo">
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;">
                <option value="" disabled="" selected="">Choose target...</option>
              <option value="esp32">ESP32</option><option value="esp32s2">ESP32-S2</option><option value="esp32s3">ESP32-S3</option><option value="esp32c2">ESP32-C2</option><option value="esp32c3">ESP32-C3</option></select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;">
              <option value="" disabled="" selected="">Choose version...</option>
            <option value="v4.4.2" data-has_target="true">stable (v4.4.2)</option><option value="v4.3.4" data-has_target="true">v4.3.4</option><option value="v4.2.4" data-has_target="true">v4.2.4</option><option value="v4.1.3" data-has_target="false">v4.1.3</option><option value="" disabled="">Pre-Release Versions</option><option value="latest" data-has_target="true">master (latest)</option><option value="v5.0-beta1" data-has_target="true">v5.0-beta1</option><option value="release-v5.0" data-has_target="true">release/v5.0</option><option value="release-v4.4" data-has_target="true">release/v4.4</option><option value="release-v4.3" data-has_target="true">release/v4.3</option><option value="release-v4.2" data-has_target="true">release/v4.2</option><option value="release-v4.1" data-has_target="false">release/v4.1</option></select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current" aria-expanded="true">
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current" aria-expanded="true"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/index.html"><button class="toctree-expand" title="Open/close menu"></button>API Reference</a><ul class="" aria-expanded="false">
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/api-conventions.html">API Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/protocols/index.html">Application Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/bluetooth/index.html">Bluetooth API</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/error-codes.html">Error Codes Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/network/index.html">Networking APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/index.html">Peripherals API</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/kconfig.html">Project Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/provisioning/index.html">Provisioning API</a></li>
<li class="toctree-l2 current" aria-expanded="true"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/index.html"><button class="toctree-expand" title="Open/close menu"></button>Storage API</a><ul class="" aria-expanded="false">
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/fatfs.html">FAT Filesystem Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/mass_mfg.html">Manufacturing Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/nvs_flash.html">Non-volatile Storage Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/nvs_partition_gen.html">NVS Partition Generator Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/nvs_partition_parse.html">NVS Partition Parser Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/sdmmc.html">SD/SDIO/MMC Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spi_flash.html">SPI Flash API</a></li>
<li class="toctree-l3 current" aria-expanded="true"><a class="reference internal current" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#" aria-expanded="true"><button class="toctree-expand" title="Open/close menu"></button>SPIFFS Filesystem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#notes">Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#tools">Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#see-also">See also</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#application-example">Application Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#high-level-api-reference">High-level API Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/vfs.html">Virtual filesystem component</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/wear-levelling.html">Wear Levelling API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/index.html">System API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/migration-guides/index.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/index.html" class="icon icon-home"></a> »</li>
          <li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/index.html">API Reference</a> »</li>
          <li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/index.html">Storage API</a> »</li>
      <li>SPIFFS Filesystem</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/1c84cfde14/docs/en/api-reference/storage/spiffs.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="spiffs-filesystem">
<h1>SPIFFS Filesystem<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#spiffs-filesystem" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/storage/spiffs.html">[中文]</a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#overview" title="Permalink to this headline"></a></h2>
<p>SPIFFS is a file system intended for SPI NOR flash devices on embedded targets. It supports wear levelling, file system consistency checks, and more.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#notes" title="Permalink to this headline"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Currently, SPIFFS does not support directories, it produces a flat structure. If SPIFFS is mounted under <code class="docutils literal notranslate"><span class="pre">/spiffs</span></code>, then creating a file with the path <code class="docutils literal notranslate"><span class="pre">/spiffs/tmp/myfile.txt</span></code> will create a file called <code class="docutils literal notranslate"><span class="pre">/tmp/myfile.txt</span></code> in SPIFFS, instead of <code class="docutils literal notranslate"><span class="pre">myfile.txt</span></code> in the directory <code class="docutils literal notranslate"><span class="pre">/spiffs/tmp</span></code>.</p></li>
<li><p>It is not a real-time stack. One write operation might take much longer than another.</p></li>
<li><p>For now, it does not detect or handle bad blocks.</p></li>
<li><p>SPIFFS is able to reliably utilize only around 75% of assigned partition space.</p></li>
<li><p>When the filesystem is running out of space, the garbage collector is trying to find free space by scanning the filesystem multiple times, which can take up to several seconds per write function call, depending on required space. This is caused by the SPIFFS design and the issue has been reported multiple times (e.g. <a class="reference external" href="https://github.com/espressif/esp-idf/issues/1737">here</a>) and in the official <a class="reference external" href="https://github.com/pellepl/spiffs/issues/">SPIFFS github repository</a>. The issue can be partially mitigated by the <a class="reference external" href="https://github.com/pellepl/spiffs/wiki/Configure-spiffs">SPIFFS configuration</a>.</p></li>
<li><p>Deleting a file does not always remove the whole file, which leaves unusable sections throughout the filesystem.</p></li>
<li><p>When the chip experiences a power loss during a file system operation it could result in SPIFFS corruption. However the file system still might be recovered via <code class="docutils literal notranslate"><span class="pre">esp_spiffs_check</span></code> function. More details in the official SPIFFS <cite>FAQ &lt;https://github.com/pellepl/spiffs/wiki/FAQ&gt;</cite>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="tools">
<h2>Tools<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#tools" title="Permalink to this headline"></a></h2>
<section id="spiffsgen-py">
<h3>spiffsgen.py<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#spiffsgen-py" title="Permalink to this headline"></a></h3>
<p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/1c84cfde14/components/spiffs/spiffsgen.py">spiffsgen.py</a> is a write-only Python SPIFFS implementation used to create filesystem images from the contents of a host folder. To use <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code>, open Terminal and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre id="codecell0"><span></span><span class="n">python</span> <span class="n">spiffsgen</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;</span><span class="n">image_size</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">base_dir</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">output_file</span><span class="o">&gt;</span>
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell0">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
<p>The required arguments are as follows:</p>
<ul class="simple">
<li><p><strong>image_size</strong>: size of the partition onto which the created SPIFFS image will be flashed.</p></li>
<li><p><strong>base_dir</strong>: directory for which the SPIFFS image needs to be created.</p></li>
<li><p><strong>output_file</strong>: SPIFFS image output file.</p></li>
</ul>
<p>There are also other arguments that control image generation. Documentation on these arguments can be found in the tool’s help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre id="codecell1"><span></span><span class="n">python</span> <span class="n">spiffsgen</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell1">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
<p>These optional arguments correspond to a possible SPIFFS build configuration. To generate the right image, please make sure that you use the same arguments/configuration as were used to build SPIFFS. As a guide, the help output indicates the SPIFFS build configuration to which the argument corresponds. In cases when these arguments are not specified, the default values shown in the help output will be used.</p>
<p>When the image is created, it can be flashed using <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code> or <code class="docutils literal notranslate"><span class="pre">parttool.py</span></code>.</p>
<p>Aside from invoking the <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code> standalone by manually running it from the command line or a script, it is also possible to invoke <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code> directly from the build system by calling <code class="docutils literal notranslate"><span class="pre">spiffs_create_partition_image</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre id="codecell2"><span></span><span class="n">spiffs_create_partition_image</span><span class="p">(</span><span class="o">&lt;</span><span class="n">partition</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">base_dir</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">FLASH_IN_PROJECT</span><span class="p">]</span> <span class="p">[</span><span class="n">DEPENDS</span> <span class="n">dep</span> <span class="n">dep</span> <span class="n">dep</span><span class="o">...</span><span class="p">])</span>
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell2">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
<p>This is more convenient as the build configuration is automatically passed to the tool, ensuring that the generated image is valid for that build. An example of this is while the <em>image_size</em> is required for the standalone invocation, only the <em>partition</em> name is required when using <code class="docutils literal notranslate"><span class="pre">spiffs_create_partition_image</span></code> – the image size is automatically obtained from the project’s partition table.</p>
<p><code class="docutils literal notranslate"><span class="pre">spiffs_create_partition_image</span></code> must be called from one of the component CMakeLists.txt files.</p>
<p>Optionally, users can opt to have the image automatically flashed together with the app binaries, partition tables, etc. on <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">flash</span></code> by specifying <code class="docutils literal notranslate"><span class="pre">FLASH_IN_PROJECT</span></code>.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre id="codecell3"><span></span><span class="n">spiffs_create_partition_image</span><span class="p">(</span><span class="n">my_spiffs_partition</span> <span class="n">my_folder</span> <span class="n">FLASH_IN_PROJECT</span><span class="p">)</span>
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell3">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
<p>If FLASH_IN_PROJECT/SPIFFS_IMAGE_FLASH_IN_PROJECT is not specified, the image will still be generated, but you will have to flash it manually using <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code>, <code class="docutils literal notranslate"><span class="pre">parttool.py</span></code>, or a custom build system target.</p>
<p>There are cases where the contents of the base directory itself is generated at build time. Users can use DEPENDS/SPIFFS_IMAGE_DEPENDS to specify targets that should be executed before generating the image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre id="codecell4"><span></span><span class="n">add_custom_target</span><span class="p">(</span><span class="n">dep</span> <span class="n">COMMAND</span> <span class="o">...</span><span class="p">)</span>

<span class="n">spiffs_create_partition_image</span><span class="p">(</span><span class="n">my_spiffs_partition</span> <span class="n">my_folder</span> <span class="n">DEPENDS</span> <span class="n">dep</span><span class="p">)</span>
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell4">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
<p>For an example, see <a class="reference external" href="https://github.com/espressif/esp-idf/tree/1c84cfde14/examples/storage/spiffsgen">storage/spiffsgen</a>.</p>
</section>
<section id="mkspiffs">
<h3>mkspiffs<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#mkspiffs" title="Permalink to this headline"></a></h3>
<p>Another tool for creating SPIFFS partition images is <a class="reference external" href="https://github.com/igrr/mkspiffs">mkspiffs</a>. Similar to <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code>, it can be used to create an image from a given folder and then flash that image using <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code></p>
<p>For that, you need to obtain the following parameters:</p>
<ul class="simple">
<li><p><strong>Block Size</strong>: 4096 (standard for SPI Flash)</p></li>
<li><p><strong>Page Size</strong>: 256 (standard for SPI Flash)</p></li>
<li><p><strong>Image Size</strong>: Size of the partition in bytes (can be obtained from a partition table)</p></li>
<li><p><strong>Partition Offset</strong>: Starting address of the partition (can be obtained from a partition table)</p></li>
</ul>
<p>To pack a folder into a 1-Megabyte image, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre id="codecell5"><span></span><span class="n">mkspiffs</span> <span class="o">-</span><span class="n">c</span> <span class="p">[</span><span class="n">src_folder</span><span class="p">]</span> <span class="o">-</span><span class="n">b</span> <span class="mi">4096</span> <span class="o">-</span><span class="n">p</span> <span class="mi">256</span> <span class="o">-</span><span class="n">s</span> <span class="mh">0x100000</span> <span class="n">spiffs</span><span class="o">.</span><span class="n">bin</span>
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell5">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
<p>To flash the image onto ESP32 at offset 0x110000, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre id="codecell6"><span></span><span class="n">python</span> <span class="n">esptool</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">chip</span> <span class="n">esp32</span> <span class="o">--</span><span class="n">port</span> <span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">--</span><span class="n">baud</span> <span class="p">[</span><span class="n">baud</span><span class="p">]</span> <span class="n">write_flash</span> <span class="o">-</span><span class="n">z</span> <span class="mh">0x110000</span> <span class="n">spiffs</span><span class="o">.</span><span class="n">bin</span>
</pre><button class="copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#codecell6">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <title>Copy to clipboard</title>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
  <rect x="8" y="8" width="12" height="12" rx="2"></rect>
  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path>
</svg>
    </button></div>
</div>
<section id="notes-on-which-spiffs-tool-to-use">
<h4>Notes on which SPIFFS tool to use<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#notes-on-which-spiffs-tool-to-use" title="Permalink to this headline"></a></h4>
<p>The two tools presented above offer very similar functionality. However, there are reasons to prefer one over the other, depending on the use case.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code> in the following cases:</p>
<ol class="arabic simple">
<li><p>If you want to simply generate a SPIFFS image during the build. <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code> makes it very convenient by providing functions/commands from the build system itself.</p></li>
<li><p>If the host has no C/C++ compiler available, because <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code> does not require compilation.</p></li>
</ol>
<p>Use <code class="docutils literal notranslate"><span class="pre">mkspiffs</span></code> in the following cases:</p>
<ol class="arabic simple">
<li><p>If you need to unpack SPIFFS images in addition to image generation. For now, it is not possible with <code class="docutils literal notranslate"><span class="pre">spiffsgen.py</span></code>.</p></li>
<li><p>If you have an environment where a Python interpreter is not available, but a host compiler is available. Otherwise, a pre-compiled <code class="docutils literal notranslate"><span class="pre">mkspiffs</span></code> binary can do the job. However, there is no build system integration for <code class="docutils literal notranslate"><span class="pre">mkspiffs</span></code> and the user has to do the corresponding work: compiling <code class="docutils literal notranslate"><span class="pre">mkspiffs</span></code> during build (if a pre-compiled binary is not used), creating build rules/targets for the output files, passing proper parameters to the tool, etc.</p></li>
</ol>
</section>
</section>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#see-also" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/partition-tables.html"><span class="doc">Partition Table documentation</span></a></p></li>
</ul>
</section>
<section id="application-example">
<h2>Application Example<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#application-example" title="Permalink to this headline"></a></h2>
<p>An example of using SPIFFS is provided in the <a class="reference external" href="https://github.com/espressif/esp-idf/tree/1c84cfde14/examples/storage/spiffs">storage/spiffs</a> directory. This example initializes and mounts a SPIFFS partition, then writes and reads data from it using POSIX and C library APIs. See the README.md file in the example directory for more information.</p>
</section>
<section id="high-level-api-reference">
<h2>High-level API Reference<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#high-level-api-reference" title="Permalink to this headline"></a></h2>
<section id="header-file">
<h3>Header File<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#header-file" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/1c84cfde14/components/spiffs/include/esp_spiffs.h">components/spiffs/include/esp_spiffs.h</a></p></li>
</ul>
</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#functions" title="Permalink to this headline"></a></h3>
<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv423esp_vfs_spiffs_registerPK21esp_vfs_spiffs_conf_t">
<span id="_CPPv323esp_vfs_spiffs_registerPK21esp_vfs_spiffs_conf_t"></span><span id="_CPPv223esp_vfs_spiffs_registerPK21esp_vfs_spiffs_conf_t"></span><span id="esp_vfs_spiffs_register__esp_vfs_spiffs_conf_tCP"></span><span class="target" id="esp__spiffs_8h_1a22884e61c20b1eb47b2433384c142b0b"></span><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_vfs_spiffs_register</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv421esp_vfs_spiffs_conf_t" title="esp_vfs_spiffs_conf_t"><span class="n"><span class="pre">esp_vfs_spiffs_conf_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">conf</span></span><span class="sig-paren">)</span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv423esp_vfs_spiffs_registerPK21esp_vfs_spiffs_conf_t" title="Permalink to this definition"></a><br></dt>
<dd><p>Register and mount SPIFFS to VFS with given path prefix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>conf</strong> – Pointer to <a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#structesp__vfs__spiffs__conf__t"><span class="std std-ref">esp_vfs_spiffs_conf_t</span></a> configuration structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p><ul class="simple">
<li><p>ESP_OK if success</p></li>
<li><p>ESP_ERR_NO_MEM if objects could not be allocated</p></li>
<li><p>ESP_ERR_INVALID_STATE if already mounted or partition is encrypted</p></li>
<li><p>ESP_ERR_NOT_FOUND if partition for SPIFFS was not found</p></li>
<li><p>ESP_FAIL if mount or format fails </p></li>
</ul>
<p></p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv425esp_vfs_spiffs_unregisterPKc">
<span id="_CPPv325esp_vfs_spiffs_unregisterPKc"></span><span id="_CPPv225esp_vfs_spiffs_unregisterPKc"></span><span id="esp_vfs_spiffs_unregister__cCP"></span><span class="target" id="esp__spiffs_8h_1a5102c648b052fc2db4dfa65737fbe888"></span><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_vfs_spiffs_unregister</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">partition_label</span></span><span class="sig-paren">)</span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv425esp_vfs_spiffs_unregisterPKc" title="Permalink to this definition"></a><br></dt>
<dd><p>Unregister and unmount SPIFFS from VFS</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>partition_label</strong> – Same label as passed to esp_vfs_spiffs_register.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p><ul class="simple">
<li><p>ESP_OK if successful</p></li>
<li><p>ESP_ERR_INVALID_STATE already unregistered </p></li>
</ul>
<p></p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv418esp_spiffs_mountedPKc">
<span id="_CPPv318esp_spiffs_mountedPKc"></span><span id="_CPPv218esp_spiffs_mountedPKc"></span><span id="esp_spiffs_mounted__cCP"></span><span class="target" id="esp__spiffs_8h_1a7d717d49ab365dd4e13578f97bd4825d"></span><span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_spiffs_mounted</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">partition_label</span></span><span class="sig-paren">)</span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv418esp_spiffs_mountedPKc" title="Permalink to this definition"></a><br></dt>
<dd><p>Check if SPIFFS is mounted</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>partition_label</strong> – Optional, label of the partition to check. If not specified, first partition with subtype=spiffs is used.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p><ul class="simple">
<li><p>true if mounted</p></li>
<li><p>false if not mounted </p></li>
</ul>
<p></p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv417esp_spiffs_formatPKc">
<span id="_CPPv317esp_spiffs_formatPKc"></span><span id="_CPPv217esp_spiffs_formatPKc"></span><span id="esp_spiffs_format__cCP"></span><span class="target" id="esp__spiffs_8h_1a25c9968f444715dca56e77797b7c8eb8"></span><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_spiffs_format</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">partition_label</span></span><span class="sig-paren">)</span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv417esp_spiffs_formatPKc" title="Permalink to this definition"></a><br></dt>
<dd><p>Format the SPIFFS partition</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>partition_label</strong> – Same label as passed to esp_vfs_spiffs_register. </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p><ul class="simple">
<li><p>ESP_OK if successful</p></li>
<li><p>ESP_FAIL on error </p></li>
</ul>
<p></p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv415esp_spiffs_infoPKcP6size_tP6size_t">
<span id="_CPPv315esp_spiffs_infoPKcP6size_tP6size_t"></span><span id="_CPPv215esp_spiffs_infoPKcP6size_tP6size_t"></span><span id="esp_spiffs_info__cCP.sP.sP"></span><span class="target" id="esp__spiffs_8h_1ae0c787bee510e91a7ba299fd5313d02a"></span><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_spiffs_info</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">partition_label</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">total_bytes</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">used_bytes</span></span><span class="sig-paren">)</span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv415esp_spiffs_infoPKcP6size_tP6size_t" title="Permalink to this definition"></a><br></dt>
<dd><p>Get information for SPIFFS</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>partition_label</strong> – Same label as passed to esp_vfs_spiffs_register </p></li>
<li><p><strong>total_bytes</strong> – <strong>[out]</strong> Size of the file system </p></li>
<li><p><strong>used_bytes</strong> – <strong>[out]</strong> Current used bytes in the file system</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p><ul class="simple">
<li><p>ESP_OK if success</p></li>
<li><p>ESP_ERR_INVALID_STATE if not mounted </p></li>
</ul>
<p></p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv416esp_spiffs_checkPKc">
<span id="_CPPv316esp_spiffs_checkPKc"></span><span id="_CPPv216esp_spiffs_checkPKc"></span><span id="esp_spiffs_check__cCP"></span><span class="target" id="esp__spiffs_8h_1a2373774a1991c4b6ce38637e0fb3e870"></span><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_spiffs_check</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">partition_label</span></span><span class="sig-paren">)</span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv416esp_spiffs_checkPKc" title="Permalink to this definition"></a><br></dt>
<dd><p>Check integrity of SPIFFS</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>partition_label</strong> – Same label as passed to esp_vfs_spiffs_register </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p><ul class="simple">
<li><p>ESP_OK if successful</p></li>
<li><p>ESP_ERR_INVALID_STATE if not mounted</p></li>
<li><p>ESP_FAIL on error </p></li>
</ul>
<p></p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv413esp_spiffs_gcPKc6size_t">
<span id="_CPPv313esp_spiffs_gcPKc6size_t"></span><span id="_CPPv213esp_spiffs_gcPKc6size_t"></span><span id="esp_spiffs_gc__cCP.s"></span><span class="target" id="esp__spiffs_8h_1aa3e3a07e45b18b966a7365860b66d1e4"></span><a class="reference internal" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_spiffs_gc</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">partition_label</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">size_to_gc</span></span><span class="sig-paren">)</span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv413esp_spiffs_gcPKc6size_t" title="Permalink to this definition"></a><br></dt>
<dd><p>Perform garbage collection in SPIFFS partition. </p>
<p>Call this function to run GC and ensure that at least the given amount of space is available in the partition. This function will fail with ESP_ERR_NOT_FINISHED if it is not possible to reclaim the requested space (that is, not enough free or deleted pages in the filesystem). This function will also fail if it fails to reclaim the requested space after CONFIG_SPIFFS_GC_MAX_RUNS number of GC iterations. On one GC iteration, SPIFFS will erase one logical block (4kB). Therefore the value of CONFIG_SPIFFS_GC_MAX_RUNS should be set at least to the maximum expected size_to_gc, divided by 4096. For example, if the application expects to make room for a 1MB file and calls esp_spiffs_gc(label, 1024 * 1024), CONFIG_SPIFFS_GC_MAX_RUNS should be set to at least 256. On the other hand, increasing CONFIG_SPIFFS_GC_MAX_RUNS value increases the maximum amount of time for which any SPIFFS GC or write operation may potentially block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>partition_label</strong> – Label of the partition to be garbage-collected. The partition must be already mounted. </p></li>
<li><p><strong>size_to_gc</strong> – The number of bytes that the GC process should attempt to make available. </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p><ul class="simple">
<li><p>ESP_OK on success</p></li>
<li><p>ESP_ERR_NOT_FINISHED if GC fails to reclaim the size given by size_to_gc</p></li>
<li><p>ESP_ERR_INVALID_STATE if the partition is not mounted</p></li>
<li><p>ESP_FAIL on all other errors </p></li>
</ul>
<p></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="structures">
<h3>Structures<a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#structures" title="Permalink to this headline"></a></h3>
<dl class="cpp struct">
<dt class="sig sig-object cpp" id="_CPPv421esp_vfs_spiffs_conf_t">
<span id="_CPPv321esp_vfs_spiffs_conf_t"></span><span id="_CPPv221esp_vfs_spiffs_conf_t"></span><span id="esp_vfs_spiffs_conf_t"></span><span class="target" id="structesp__vfs__spiffs__conf__t"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_vfs_spiffs_conf_t</span></span></span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv421esp_vfs_spiffs_conf_t" title="Permalink to this definition"></a><br></dt>
<dd><p>Configuration structure for esp_vfs_spiffs_register. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N21esp_vfs_spiffs_conf_t9base_pathE">
<span id="_CPPv3N21esp_vfs_spiffs_conf_t9base_pathE"></span><span id="_CPPv2N21esp_vfs_spiffs_conf_t9base_pathE"></span><span id="esp_vfs_spiffs_conf_t::base_path__cCP"></span><span class="target" id="structesp__vfs__spiffs__conf__t_1add2c60af836f5dc9526885adc3a3d1c8"></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">base_path</span></span></span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv4N21esp_vfs_spiffs_conf_t9base_pathE" title="Permalink to this definition"></a><br></dt>
<dd><p>File path prefix associated with the filesystem. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N21esp_vfs_spiffs_conf_t15partition_labelE">
<span id="_CPPv3N21esp_vfs_spiffs_conf_t15partition_labelE"></span><span id="_CPPv2N21esp_vfs_spiffs_conf_t15partition_labelE"></span><span id="esp_vfs_spiffs_conf_t::partition_label__cCP"></span><span class="target" id="structesp__vfs__spiffs__conf__t_1ae228e117d84f2f03ffc947165f3ad10e"></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">partition_label</span></span></span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv4N21esp_vfs_spiffs_conf_t15partition_labelE" title="Permalink to this definition"></a><br></dt>
<dd><p>Optional, label of SPIFFS partition to use. If set to NULL, first partition with subtype=spiffs will be used. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N21esp_vfs_spiffs_conf_t9max_filesE">
<span id="_CPPv3N21esp_vfs_spiffs_conf_t9max_filesE"></span><span id="_CPPv2N21esp_vfs_spiffs_conf_t9max_filesE"></span><span id="esp_vfs_spiffs_conf_t::max_files__s"></span><span class="target" id="structesp__vfs__spiffs__conf__t_1a8498ca07df2b1f8bf23578718fe58d43"></span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">max_files</span></span></span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv4N21esp_vfs_spiffs_conf_t9max_filesE" title="Permalink to this definition"></a><br></dt>
<dd><p>Maximum files that could be open at the same time. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N21esp_vfs_spiffs_conf_t22format_if_mount_failedE">
<span id="_CPPv3N21esp_vfs_spiffs_conf_t22format_if_mount_failedE"></span><span id="_CPPv2N21esp_vfs_spiffs_conf_t22format_if_mount_failedE"></span><span id="esp_vfs_spiffs_conf_t::format_if_mount_failed__b"></span><span class="target" id="structesp__vfs__spiffs__conf__t_1af657485432b43e27cf4a983cba3fcccc"></span><span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">format_if_mount_failed</span></span></span><a class="headerlink" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html#_CPPv4N21esp_vfs_spiffs_conf_t22format_if_mount_failedE" title="Permalink to this definition"></a><br></dt>
<dd><p>If true, it will format the file system if it fails to mount. </p>
</dd></dl>

</div>
</dd></dl>

</section>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">
<p style="text-align:center"><a href="https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&amp;sections=SPIFFS%20Filesystem%20(api-reference/storage/spiffs)&amp;version=esp32%20latest%20(v5.1-dev-1264-g1c84cfde14)">Provide feedback about this document</a></p>

             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spi_flash_concurrency.html" class="btn btn-neutral float-left" title="Concurrency Constraints for flash on SPI1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/vfs.html" class="btn btn-neutral float-right" title="Virtual filesystem component" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr>

  <div role="contentinfo">
    <p>© Copyright 2016 - 2022, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/esp-idf-en-v5.1-dev-1264-g1c84cfde14-esp32.pdf" class="fa fa-file-pdf-o"> Download PDF</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 


</body></html>